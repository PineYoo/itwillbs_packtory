<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layouts/de_layout}">

<head>
    <title>팩토리(PackTory) - 사원 상세</title>
    <th:block layout:fragment="css">
        <link href="/css/sb-admin-2.css" rel="stylesheet">
        <link href="/css/common.css" rel="stylesheet">
    </th:block>
</head>

<body id="page-top">
<div layout:fragment="contents">
    <div class="container mt-5">
        <h2 class="h3 mb-4 text-gray-800">사원 상세</h2>

        <form id="employeeForm" th:action="@{/human/employee/detail/{id}(id=${employeeDetailDTO.id})}" method="post">
            <!-- 사원번호 (수정 불가) -->
            <div class="form-group">
                <label>사원번호</label>
                <span th:text="${employeeDetailDTO.id}" class="form-control-plaintext"></span>
            </div>

            <!-- 주민번호 (수정 불가) -->
            <div class="form-group">
                <label>주민번호</label>
                <span th:text="${employeeDetailDTO.ssn}" class="form-control-plaintext"></span>
            </div>

            <div class="form-group">
                <label>전화번호</label>
                <input type="text" name="phoneNumber" th:value="${employeeDetailDTO.phoneNumber}" class="form-control" readonly>
            </div>

            <div class="form-group">
                <label>이메일</label>
                <input type="text" name="email" th:value="${employeeDetailDTO.email}" class="form-control" readonly>
            </div>

            <div class="form-group">
                <label>성별</label>
                <select name="gender" class="form-control" disabled>
                    <option value="M" th:selected="${employeeDetailDTO.gender == 'M'}">남성</option>
                    <option value="F" th:selected="${employeeDetailDTO.gender == 'F'}">여성</option>
                </select>
            </div>

            <div class="form-group">
                <label>주소1</label>
                <input type="text" name="address1" th:value="${employeeDetailDTO.address1}" class="form-control" readonly>
            </div>

            <div class="form-group">
                <label>주소2</label>
                <input type="text" name="address2" th:value="${employeeDetailDTO.address2}" class="form-control" readonly>
            </div>

            <div class="form-group">
                <label>급여은행 코드</label>
                <input type="text" name="salaryBankCode" th:value="${employeeDetailDTO.salaryBankCode}" class="form-control" readonly>
            </div>

            <div class="form-group">
                <label>급여은행 이름</label>
                <input type="text" name="salaryBankName" th:value="${employeeDetailDTO.salaryBankName}" class="form-control" readonly>
            </div>

            <div class="form-group">
                <label>급여계좌번호</label>
                <input type="text" name="salaryAccountNumber" th:value="${employeeDetailDTO.salaryAccountNumber}" class="form-control" readonly>
            </div>

            <div class="form-group">
                <label>급여계좌 예금주</label>
                <input type="text" name="salaryAccountHolder" th:value="${employeeDetailDTO.salaryAccountHolder}" class="form-control" readonly>
            </div>

            <div class="form-group">
                <label>직원 차량 여부</label>
                <input type="text" name="hasVehicle" th:value="${employeeDetailDTO.hasVehicle}" class="form-control" readonly>
            </div>

            <div class="form-group">
                <label>직원 상태 코드</label>
                <input type="text" name="employeeStatusCode" th:value="${employeeDetailDTO.employeeStatusCode}" class="form-control" readonly>
            </div>

            <div class="form-group">
                <label>상태 시작일</label>
                <input type="date" name="statusStartDate" th:value="${employeeDetailDTO.statusStartDate}" class="form-control" readonly>
            </div>

            <div class="form-group">
                <label>상태 종료일</label>
                <input type="date" name="statusEndDate" th:value="${employeeDetailDTO.statusEndDate}" class="form-control" readonly>
            </div>

            <!-- 작성자 (수정 불가) -->
            <div class="form-group">
                <label>작성자</label>
                <span th:text="${employeeDetailDTO.regId}" class="form-control-plaintext"></span>
            </div>

            <!-- 작성일자 (수정 불가) -->
            <div class="form-group">
                <label>작성일자</label>
                <span th:text="${employeeDetailDTO.regDate}" class="form-control-plaintext"></span>
            </div>

            <!-- 최종 수정자 (수정 불가) -->
            <div class="form-group">
                <label>최종 수정자</label>
                <span th:text="${employeeDetailDTO.modId}" class="form-control-plaintext"></span>
            </div>

            <!-- 최종 수정일자 (수정 불가) -->
            <div class="form-group">
                <label>최종 수정일자</label>
                <span th:text="${employeeDetailDTO.modDate}" class="form-control-plaintext"></span>
            </div>

            <div class="mt-4">
                <button type="button" id="editBtn" class="btn btn-warning">수정</button>
                <button type="submit" id="submitBtn" class="btn btn-primary" style="display: none;">저장</button>
                <button type="button" id="deleteBtn" class="btn btn-danger" th:data-id="${employeeDetailDTO.id}">삭제</button>
                <a href="/human/employee" class="btn btn-secondary float-right">목록으로</a>
            </div>
        </form>
    </div>
</div>

<th:block layout:fragment="script">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        // 수정 버튼
        $("#editBtn").on("click", function () {
            $("input[readonly]").prop("readonly", false);
            $("select[disabled]").prop("disabled", false);
            $("#submitBtn").show();
            $(this).hide();

            // 수정 불가 필드 다시 비활성화
            $("input[name='id']").prop("readonly", true);
            $("input[name='ssn']").prop("readonly", true);
        });

        // 삭제 버튼
        $("#deleteBtn").on("click", function () {
            const empId = $(this).data("id");
            if (confirm("정말 삭제하시겠습니까?")) {
                $.ajax({
                    url: `/human/employee/${empId}/delete`,
                    type: "POST",
                    success: function (response) {
                        if (response === "success") {
                            alert("삭제 완료!");
                            location.href = "/human/employee";
                        } else {
                            alert("삭제 실패: " + response);
                        }
                    },
                    error: function () {
                        alert("삭제 중 오류가 발생했습니다.");
                    }
                });
            }
        });
    });
</script>
</th:block>
</body>
</html>
