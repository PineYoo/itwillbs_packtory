<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
		xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
		layout:decorate="~{common/layouts/de_layout}">
<head>
<title>팩토리(PackTory) - 로그 관리</title>
	<link href="/css/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">
	<style type="text/css">
	/* 검색바 중앙에 세로줄 */
	.left-form {
		border-right: 1px solid #e3e6f0;
	}
	
	@media (max-width: 768px) {
	  .left-form {
	    border-right: none !important;
	  }
	}
	</style>
</head>
<body id="page-top">
	<th:block layout:fragment="contents">
		<!-- Begin Page Content -->
		<div class="container-fluid">
			<!-- Page Heading -->
			<div class="d-sm-flex align-items-center justify-content-between mb-4">
				<h1 class="h3 mb-2 text-gray-800">로그 관리</h1>
			</div>

			<!-- ---------- 검색바 컨테이너 ---------- -->
			<div class="card shadow mb-4">
				<div class="card-body">
					<!-- ---------- 검색바 ---------- -->
					<div class="search-wrap border">
						<section class="d-flex search-inner">
							<div class="col pl-4 search-box">
								<form th:action="@{/admin/log/search}" method="get" th:object="${logSearchDTO}" id="logSearchForm">
									<input type="hidden" th:field="*{pageDTO.page}">
									<input type="hidden" th:field="*{pageDTO.size}">
									<div class="container-fluid px-5">
										<div class="row">
											<!-- 왼쪽 컬럼 -->
											<div class="col-md-6">
												<!-- 사원번호 -->
												<div class="form-group row mb-3">
													<label for="accessType" class="col-sm-3 col-form-label">접속타입</label>
													<div class="col-sm-9">
															<select name="accessType" id="accessType" th:value="*{accessType}" class="form-select">
																<option value="" th:selected="*{accessType} eq '' ">전체</option>
																<option th:each="code : ${accessTypeList}" th:value="${code.minorCode}" 
																	th:text="${code.minorName}" th:selected="*{accessType} == ${code.minorCode}"></option>
															</select>
													</div>
												</div>
												<!-- 사원이름 -->
												<div class="form-group row mb-3">
													<label for="accessDevice" class="col-sm-3 col-form-label">접속장치</label>
													<div class="col-sm-9">
															<select name="accessDevice" id="accessDevice" th:value="*{accessDevice}" class="form-select">
																<option value="" th:selected="*{accessType} eq '' ">전체</option>
																<option th:each="code : ${accessDeviceList}" th:value="${code.minorCode}" 
																		th:text="${code.minorName}" th:selected="*{accessDevice} == ${code.minorCode}"></option>
															</select>
													</div>
												</div>
												<!-- 입사일자 -->
												<div class="form-group row mb-3">
													<label for="accessStartDate" class="col-sm-3 col-form-label">로그일자</label>
													<div class="col-sm-9">
														<div class="d-flex align-items-center">
															<div class="input-group">
																<input type="text" id="accessStartDate" th:field="*{accessStartDate}" class="form-control" autocomplete="off">
																	<span class="input-group-text calendar-icon">
																		<i class="fa fa-calendar"></i>
																	</span>
															</div>
															<span class="mx-2">⁓</span>
															<div class="input-group">
																<input type="text" id="accessEndDate" th:field="*{accessEndDate}" class="form-control" autocomplete="off">
																	<span class="input-group-text calendar-icon">
																		<i class="fa fa-calendar"></i>
																	</span>
															</div>
														</div>
													</div>
												</div>
											</div>
											
											<!-- 오른쪽 컬럼 -->
											<div class="col-md-6">
												<!-- 사용자ID -->
												<div class="form-group row mb-3">
													<label for="accessId" class="col-sm-3 col-form-label">사용자ID</label>
													<div class="col-sm-9">
														<input type="text" th:field="*{accessId}" class="form-control">
													</div>
												</div>

												<!-- 접속IP -->
												<div class="form-group row mb-3">
													<label for="ip" class="col-sm-3 col-form-label">접속IP</label>
													<div class="col-sm-9">
														<input type="text" th:field="*{ip}" class="form-control">
													</div>
												</div>
												<!-- 파라미터 -->
												<div class="form-group row mb-3">
													<label for="parameters" class="col-sm-3 col-form-label">파라미터</label>
													<div class="col-sm-9">
														<input type="text" th:field="*{parameters}" class="form-control">
													</div>
												</div>
											</div>
										</div>
										<!-- 검색바 버튼 -->
										<div class="row justify-content-end">
											<div class="col-12 col-sm-auto mb-2">
												<button type="submit" class="btn btn-primary btn-block" id="btnSearch">검색</button>
											</div>
										</div>
										<!-- 검색바 버튼 끝 -->
									</div>
								</form>
							</div>
						</section>
					</div>
					<!-- ---------- 검색바 끝 ---------- -->
				</div> 
			</div>
			<!-- ---------- 검색바 컨테이너 끝 ---------- -->
			<!-- 리스트 출력 -->
			<div class="card shadow mb-4">
				<div class="card-body">
					<div class="table-responsive"><!-- 반응형으로 해준다는 말이겠지? -->
						<div class="row">
							<table class="table table-bordered table-hover text-center" id="dataTables" width="100%" cellspacing="0">
								<thead>
									<tr>
										<th>번호</th>
										<th>아이디</th>
										<th>접근타입</th>
										<th>접근장치</th>
										<th>IP</th>
										<th>URL</th>
										<th>접근일자</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="item, status : ${logSearchDTO.list}" th:data-id="${item.idx}" class="clickable-row">
										<!-- <th:block th:object="${item}"> -->
										<td th:text="${status.count}"></td>
										<td th:text="${item.accessId}"></td>
										<td th:text="${item.accessType}"></td>
										<td th:text="${item.accessDevice}"></td>
										<td th:text="${item.ip}"></td>
										<td th:text="${item.url}"></td>
										<td th:text="${#temporals.format(item.accessDate, 'yyyy-MM-dd hh:mm:ss')}"></td>
									</tr>
									<tr th:if="${#lists.isEmpty(logSearchDTO.list)}" class="clickable-row menu2depth_items">
										<td colspan="7"><span>조회 된 데이터가 없습니다.</span></td>
									</tr>
								</tbody>
							</table>
						</div>
						<!----------페이징 시작---------->
						<div class="row">
							<!-- 페이징 네비게이션 -->
							<nav aria-label="Page navigation">
								<ul class="pagination justify-content-center">

									<!-- 이전 그룹 ... -->
									<li class="page-item"
										th:if="${logSearchDTO.pageDTO.isHasPrevGroup()}">
										<button type="button" class="page-link page-go"
											th:data-page="${logSearchDTO.pageDTO.startPageGroup - 1}">...</button>
									</li>

									<!-- 페이지 번호 반복 -->
									<li class="page-item"
										th:each="i : ${#numbers.sequence(logSearchDTO.pageDTO.getStartPageGroup(), logSearchDTO.pageDTO.getEndPageGroup())}"
										th:classappend="${i == logSearchDTO.pageDTO.page} ? 'active'">
										<button type="button" class="page-link page-go"
											th:data-page="${i}" th:text="${i}">1</button>
									</li>

									<!-- 다음 그룹 ... -->
									<li class="page-item"
										th:if="${logSearchDTO.pageDTO.isHasNextGroup()}">
										<button type="button" class="page-link page-go"
											th:data-page="${logSearchDTO.pageDTO.endPageGroup + 1}">...</button>
									</li>

								</ul>
							</nav>
						</div>
						<!----------페이징 끝---------->
					</div>
				</div>
			</div>
			<script type="text/javascript">
				$(document).ready(function() {
					console.log("document ready!");
					// init DataTable
					$('#dataTables').DataTable({
						lengthChange : false,
						searching : false,
						paging : false,
						info : false
					}); // end of $('#dataTables').DataTable({

					initDateRangePicker('accessStartDate', 'accessEndDate');
				});

				$(function() {

					$('.clickable-row').on("click", function() {
						const id = $(this).data("id");
						console.log("click id is %s", id);
						if (id != undefined && "" != id) {
							location.href = `/admin/log/${id}`;
						}
					}); // end of $('.clickable-row').on("click", function() {

				});// end of $(function() {
					
				// 페이징 nav 이벤트
				document.querySelectorAll('.page-go').forEach(function(btn) {
					btn.addEventListener('click', function(event) {
						event.preventDefault();
						const page = this.dataset.page;
						const form = document.getElementById('logSearchForm');
						form.querySelector('[name="pageDTO.page"]').value = page;
						form.submit();
					});
				});
			</script>
		</div>
	</th:block>
</body>
</html>