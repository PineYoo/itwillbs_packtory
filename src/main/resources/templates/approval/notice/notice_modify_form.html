<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{common/layouts/bs_layout}">
<head>
<title>팩토리(PackTory) - 공지사항</title>
<!-- 부트스트랩 icons 가져오기 -->
<th:block layout:fragment="headContents">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</th:block>
<!-- dataTables 가져오기 -->
<th:block layout:fragment="css">
	<link href="/css/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">
</th:block>
<style type="text/css">
.form {
	max-width: 800px;
	margin: 0 auto;
}
.custom-div {
	margin-top: 20px;
}

/* .custom-ul { */
/* 	max-width: 500px; */
/* 	width: fit-content; */
/* } */

.custom-button-area {
	margin-top: 30px;
}
	
</style>
</head>
<body id="page-top">
	<div layout:fragment="contents">
		<!-- Begin Page Content -->
		<div class="container-fluid">
			<!-- Page Heading -->
			<div class="d-sm-flex align-items-center justify-content-between mb-4">
				<h1 class="h3 mb-2 text-gray-800">공지사항 수정</h1>
			</div>			
			
			<div class="card shadow mb-4">
				<div class="card-body">
					<div class="table-responsive">
						<form th:action="@{/groupware/notice/{idx}(idx=${noticeDTO.idx})}" method="post" th:object="${noticeDTO}"
							  enctype="multipart/form-data" class="form row g-3">
							<input type="hidden" name="_method" value="put">
							<div class="col-md-12">
								<label class="mb-1" for="regId">작성자 ID</label>
								<input class="form-control" id="regId" th:field="*{regId}" readonly>
							</div>
							<!-- ------------------- -->
<!-- 							<div class="row"> -->
								<div class="col-md-6">
									<label class="mb-1" for="title">제목</label>
									<input class="form-control" id="title" th:field="*{title}" placeholder="제목 입력">
								</div>
								<div class="col-md-6">
									<label for="type" class="form-label mb-1">구분</label>
									<select id="type" class="form-select" th:field="*{type}">
										<option value="">선택</option>
										<option th:each="type : ${codeType}"
												th:value="${type.minorCode}"
												th:text="${type.minorName}">
										</option>
									</select>
								</div>
<!-- 							</div> -->
							<!-- ------------------- -->
							<div class="col-md-12">
								<label class="mb-1" for="contents">내용</label>
								<textarea class="form-control" id="contents" th:field="*{contents}" rows="15" cols="40" placeholder="내용 입력"></textarea>
							</div>
							<!-- ------------------- -->
<!-- 							<div class="row"> -->
								<div class="col-md-6">
									<label for="isDeleted" class="form-label">삭제유무</label>
									<select id="isDeleted" class="form-select" th:field="*{isDeleted}">
										<option value="">전체</option>
										<option value="N">활성화</option>
										<option value="Y">비활성화</option>
									</select>
								</div>
								<div class="col-md-6">
									<label for="isDeleted" class="form-label">메인배너등록여부</label>
									<select id="isDeleted" class="form-select" th:field="*{isBanner}">
										<option value="">선택</option>
										<option value="Y">등록</option>
										<option value="N">미등록</option>
									</select>
								</div>
<!-- 							</div> -->
							<!-- ------------------- -->
							<div class="col-md-12 custom-div" th:if="${fileList != null and not #lists.isEmpty(fileList)}">
								<h6 class="card-title">첨부파일 목록</h6>
<!-- 								<ul class="list-group custom-ul"> -->
								<ul class="list-group">
								    <li th:each="file : ${fileList}"
								    	th:if="${file.isDeleted == 'N'}"
								    	th:id="'file-' + ${file.idx}"
								    	class="list-group-item d-flex justify-content-between align-items-center">
							            <span th:text="${file.fileOriginalName}"></span>
							            <button type="button" class="btn btn-danger btn-sm fileDeleteButton" th:data-id="${file.idx}">삭제</button>
							        </li>
								</ul>
							</div>
							<!-- ------------------- -->
							<div class="col-md-12">
								<label class="mb-1" for="file">파일첨부</label>
								<input type="file" class="form-control" name="noticeFiles" multiple>
							</div>
							<!-- ------------------- -->
							<div class="col-md-12 row align-items-center justify-content-center custom-button-area">
								<button type="submit" id="btnSubmitForm" class="btn btn-primary btn-lg d-block col-3 ml-2">수정</button>
								<button type="button" id="btnExitForm" class="btn btn-danger btn-lg d-block col-3 ml-2">취소</button>
							</div>
						</form>
					</div>
				</div>
			</div>
			<script type="text/javascript">
				$(function() {
					$(".fileDeleteButton").on("click", function() {
						let idx = $(this).data("id");
						let listItem = $("#file-" + idx);
						
						if(confirm("삭제하시겠습니까?")){
							$.ajax({
								url: `/groupware/notice/fileDelete/${idx}`,
								type: "POST",
								success : function(result) {
									alert(result.message);
									listItem.fadeOut(300, function() {
										$(this).remove();
									})
								},
								fail : function(response) {
									alert(response.message);
								}
								
							});
						}
					});
				});
			</script>
		</div>
	</div>
	<th:block layout:fragment="script">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
		<script src="/js/datatables/jquery.dataTables.min.js"></script>
		<script src="/js/datatables/dataTables.bootstrap4.min.js"></script>
		<script src="/js/demo/datatables-demo.js"></script>
	</th:block>
	
	
	
</body>

</html>