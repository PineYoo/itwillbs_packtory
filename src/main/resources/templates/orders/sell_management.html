<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
		xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
		layout:decorate="~{common/layouts/de_layout}">
<head>
<title>팩토리(PackTory) - 수주관리</title>
<!-- 부트스트랩 icons 가져오기 -->
<th:block layout:fragment="headContents">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</th:block>

<!-- CSS -->
<th:block layout:fragment="css">
	<!-- dataTables 가져오기 -->
	<link href="/css/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">
	<link href="/css/datatables/datatables.min.css" rel="stylesheet">
	<link href="/css/datepicker/daterangepicker.css" rel="stylesheet">
	<!-- 폰트어썸 가져오기 -->
	<link href="/css/fontawesome/all.min.css" rel="stylesheet">
	<script src="/css/fontawesome/all.min.js"></script>
	<!-- CSS for Page -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&family=Nunito:wght@200..1000&display=swap" rel="stylesheet">
	<link href="/css/sb-admin-2.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.7.1/css/buttons.dataTables.min.css">
	<!-- 개별 CSS-->
	<link href="/css/common.css" rel="stylesheet">
</th:block>
<style type="text/css">
	
</style>

</head>

<body id="page-top">
	<div layout:fragment="contents">
		<!-- Begin Page Content -->
		<div class="container-fluid">
			<!-- Page Heading -->
			<h1 class="h3 mb-2 text-gray-800">수주관리</h1>

			<!-- ---------- 검색바 컨테이너 ---------- -->
			<div class="card shadow mb-4">
				<div class="card-body">
					
					<!-- 주문서 등록 버튼 -->
					<div class="regist-wrap">
						<!-- 로그인한 사용자 ID 저장 -->
<!-- 						<input type="hidden" id="userId" th:value="${#httpSession.getAttribute('userId')}"> -->
						<button class="btn btn-success ml-2" id="registerBtn" type="button">등록</button>
					</div>
					<!-- ---------- 검색바 ---------- -->
					<div class="search-wrap border">
						<section class="d-flex search-inner">
							<!-- 주문상태별 검색-->
							<div class="col pl-4 search-box">
								<div class="search-ttl">주문상태별</div>
								<div class="category-filter input-group">
									<div class="form-check">
										<input class="form-check-input" id="reset" type="radio" name="orderStatus"  value="0" checked>
										<label class="form-check-label" for="reset">전체</label>
									</div>
									<div class="form-check ml-3">
										<input class="form-check-input" id="notRelease" type="radio" name="orderStatus" value="1">
										<label class="form-check-label" for="notRelease">미출고</label>
									</div>
									<div class="form-check ml-3">
										<input class="form-check-input" id="complete" type="radio" name="orderStatus" value="2">
										<label class="form-check-label" for="complete">출고완료</label>
									</div>
									<div class="form-check ml-3">
										<input class="form-check-input" id="cancel" type="radio" name="orderStatus" value="3">
										<label class="form-check-label" for="cancel">취소</label>
									</div>
								</div>
				    		</div>
		
				    		<!-- 주문일자선택조회 -->
				    		<div class="col-5 px-4 search-box">
				    			<div class="search-ttl">주문일자</div>
				    			<div class="input-group align-items-center justify-content-center schDate-wrap">
			    					<input type="text" class="form-control rounded-sm mr-2" placeholder="날짜 선택" value="" name="searchDate" id="searchDate"  autocomplete="off"/>
									<button class="btn btn-primary" id="searchDateBtn" type="button"><i class="fa-solid fa-magnifying-glass"></i></button>
									<button class="btn btn-success ml-2" id="initDateBtn" type="button"><i class="fa-solid fa-rotate"></i></button>
								</div>
				    		</div>
				    		
				    		<!-- 키워드검색 -->
				    		<div class="col-4 search-box">
				    			<div class="search-ttl">검색</div>
			                     <div class="input-group">
			                         <input type="text" id="searchKeyword" class="form-control bg-light border small" name="keyword_search" placeholder="품번, 품명, 거래처명 검색" aria-label="Search" aria-describedby="basic-addon2">
			                         <div class="input-group-append">
			                             <button class="btn btn-primary" id="searchBtn" type="submit">조회</button>
			                         </div>
			                     </div>
			                </div>
			  			</section>
					</div>
					<!-- ---------- 검색바 끝 ---------- -->
                 </div>
            </div>
			<!-- ---------- 검색바 컨테이너 끝 ---------- -->
					
			<!-- ---------- 본문 컨테이너 ---------- -->
			<div class="card shadow mb-4">
				<div class="card-body">
					<div class="table-responsive">
						<table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
							<thead>
								<tr>
									<th>■</th>
									<th>주문번호</th>
									<th>주문일자</th>
									<th>거래처명</th>
									<th>공급가액</th>
									<th>부가세액</th>
									<th>합계금액</th>
									<th>출고예정일</th>
									<th>담당사원명</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="sell, status : ${sellDTOList}" th:data-id="${sell['document_number']}">
								    <td><input type="checkbox"></td>
								    <td th:text="${sell['document_number'] != null ? sell['document_number'] : '-'}"></td>
<!-- 								    <td th:text="${sell['request_date'] != null ? #temporals.format(sell['request_date'], 'yyyy-MM-dd') : 'No Date'}"></td> -->
								    <td th:text="${sell['reg_date'] != null ? sell['reg_date'] : '-'}"></td>		<!-- HashMap으로 가져오면서 String으로 들고와짐 -->
								    <td th:text="${sell['company_name'] != null ? sell['company_name'] : '-'}"></td>
								    <td th:text="${sell['supply_amount'] != null ? sell['supply_amount'] : '-'}"></td>
								    <td th:text="${sell['vat_amount'] != null ? sell['vat_amount'] : '-'}"></td>
								    <td th:text="${sell['total_amount'] != null ? sell['total_amount'] : '-'}"></td>
<!-- 								    <td th:text="${sell['expected_date'] != null ? #temporals.format(sell['expected_date'], 'yyyy-MM-dd') : 'No Date'}"></td> -->
								    <td th:text="${sell['expected_date'] != null ? sell['expected_date'] : '-'}"></td>	<!-- HashMap으로 가져오면서 String으로 들고와짐 -->
								    <td th:text="${sell['client_name'] != null ? sell['client_name'] : '회의 전'}"></td>
								</tr>

							</tbody>
						</table>
					</div>
				</div>
			</div>
			<!-- ---------- 본문 컨테이너 끝 ---------- -->			
		</div>

		<script type="text/javascript">
			$(function() {
				// 등록 버튼(registerBtn) 클릭 시 이벤트(새창 열기)
				$('#registerBtn').on("click", function() {
// 					location.href="/orders/sell/regist";
					window.open("/orders/sell/regist", "_blank", "width=810,height=1200,scrollbars=yes,resizable=yes");
				});
			    
				//---------------------------------------------------
				// 수주 리스트 각 행 클릭 시 주문 상세 클릭 시 이벤트(새창 열기)
				$("#dataTable tbody").on('click', 'tr', function() {
					var documentNumber = $(this).data('id');
					window.open("/orders/sell/" + documentNumber, "_blank", "width=810,height=1200,scrollbars=yes,resizable=yes");
				});

				//--------------------------------------------------
				
				// 필터 변경 시 데이터 테이블 다시 로드
			    $('input[name="status"]').on('change', () => productReport.draw());

			    // 검색 버튼 클릭 시 테이블 다시 로드
			    $('#searchBtn').on('click', () => productReport.draw());
			    
			    // 엔터키 입력으로 검색 실행
			    $('#searchKeyword').on('keypress', (e) => {
			        if (e.which == 13)  productReport.draw();
			    });
			    
				//---------------------------------------------------
				// 기간별 검색 필터링 제이쿼리 (datepicker)
			    $('#searchDate').daterangepicker({
//			        startDate: moment().subtract(29, 'days'),
//			        startDate: false,
//			        endDate: moment(),
			        maxDate: moment(),
			        locale: {
						start: '시작일시',
						end: '종료일시',
					    separator: " ~ ", // 시작일시와 종료일시 구분자
					    format: 'YYYY-MM-DD', // 일시 노출 포맷
					    applyLabel: "확인", // 확인 버튼 텍스트
					    cancelLabel: "취소", // 취소 버튼 텍스트
					    daysOfWeek: ["일", "월", "화", "수", "목", "금", "토"],
					    monthNames: ["1월", "2월", "3월", "4월", "5월", "6월", "7월", "8월", "9월", "10월", "11월", "12월"],
						customRangeLabel: '기간 지정',
					 },
					autoUpdateInput: false,
				    timePicker: false, // 시간 노출 여부
				    showDropdowns: true, // 년월 수동 설정 여부
				    autoApply: false, // 확인/취소 버튼 사용여부
					ranges: {
			            '오늘': [moment()], // 오늘
			            '이번 달': [moment().startOf('month'), moment().endOf('month')], // 이번 달 전체
			            '지난 달': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')], // 지난 달 전체
			            '지난 7일': [moment().subtract(6, 'days'), moment()], // 최근 7일
			            '지난 14일': [moment().subtract(13, 'days'), moment()], // 최근 14일
			            '지난 30일': [moment().subtract(29, 'days'), moment()], // 최근 30일
			            '지난 3개월': [moment().subtract(3, 'months').startOf('month'), moment().endOf('month')], // 최근 3개월
			        },
			    }).on('show.daterangepicker', function (ev, picker) {
// 			        picker.container.addClass('goodbuyCustomPicker');                            
			    });
			    
			    // 날짜 선택 후에도 placeholder 유지
			    $('#searchDate').on('apply.daterangepicker', function(ev, picker) {
			        $(this).val(`${picker.startDate.format('YYYY-MM-DD')} ~ ${picker.endDate.format('YYYY-MM-DD')}`);
			    });
			    
				// 날짜 검색 초기화
				$("#initDateBtn").on('click', function() {
					$('#searchDate').val('');
					productReport.draw();
				});
				
			    // 기간별 검색 후 테이블 다시 로드
			    $("#searchDateBtn").on('click', function() {
					productReport.draw();
				});
				
				//---------------------------------------------------
				
				
				
			});
		</script>
	</div>
	<!-- --------------------------------------------------------------------------------------------- -->
	
	<!-- JS -->
	<th:block layout:fragment="script">
		<!-- Bootstrap core JavaScript-->
		<script src="/js/bootstrap/js/bootstrap.bundle.min.js"></script>
		<script src="/js/jquery-3.7.1.js"></script>
	    <!-- Core plugin JavaScript-->
	    <script src="/js/jquery-easing/jquery.easing.min.js"></script>
	    <!-- Custom scripts for all pages-->
	    <script src="/js/sb-admin-2.min.js"></script>
	   	<!-- Page level plugins -->
		<script src="/js/datatables/jquery.dataTables.min.js"></script>
		<script src="/js/datatables/dataTables.bootstrap4.min.js"></script>
		<script src="/js/demo/datatables-demo.js"></script>
	<!-- 	<script src="/js/datatables/datatables.min.js"></script> --> <!-- 반응형 -->
	   	<script src="/js/datepicker/moment.min.js"></script>
	   	<script src="/js/datepicker/daterangepicker.js"></script>
	   	<script src="/js/datatables/dataTables.buttons.min.js"></script>
		<script src="/js/datatables/buttons.html5.min.js"></script>
		<script src="/js/datatables/jszip.min.js"></script>
		<script src="/js/datatables/buttons.print.min.js"></script>
	</th:block>
	
</body>
</html>