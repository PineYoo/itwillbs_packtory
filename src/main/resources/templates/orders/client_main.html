<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{common/layouts/bs_layout}">
<head>
<title>팩토리(PackTory) - 거래처관리</title>
<!-- 부트스트랩 icons 가져오기 -->
<th:block layout:fragment="headContents">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</th:block>
<!-- CSS -->
<th:block layout:fragment="css">
	<!-- dataTables 가져오기 -->
	<link href="/css/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">
	<link href="/css/datatables/datatables.min.css" rel="stylesheet">
	<link href="/css/datepicker/daterangepicker.css" rel="stylesheet">
	<!-- 폰트어썸 가져오기 -->
	<link href="/css/fontawesome/all.min.css" rel="stylesheet">
	<script src="/css/fontawesome/all.min.js"></script>
	<!-- CSS for Page -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&family=Nunito:wght@200..1000&display=swap" rel="stylesheet">
	<link href="/css/sb-admin-2.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.7.1/css/buttons.dataTables.min.css">
	<!-- 개별 CSS-->
	<link href="/css/common.css" rel="stylesheet">
</th:block>
<style type="text/css">
	.btnCommand {
		text-align: right;
		margin-right: 20px;
		margin-bottom: 10px;
	}
	
	.btn-close {
		font-size: 1.8rem;
		color: white;
		background-color: white;
		border: none;
	}

	.correspondent-table th {
		padding-right: 20px;
	}
	
 	.checkHead.sorting.sorting_asc:before, .checkHead.sorting.sorting_asc:after, .checkHead.sorting.sorting_desc:before, .checkHead.sorting.sorting_desc:after {
 		content: none; 
 	}
	
	/* ---------------------------- */
	input, select {
        border: 1px solid #ccc;
        padding: 5px;
        margin: 2px;
	}
	select {
    	width: 198px;
    }
	.essential {
        background-color: #fffbe6; /* 연한 노랑 */
    }
    .filled {
        background-color: white;
    }
    .postCode {
    	width:106px;
    }
    
	/* ---------------------------- */
	.data-tables {
	    width: 750px;
	    border-collapse: collapse;
	}
    @media (max-width: 768px) {
	    .data-tables td {
	      display: block;
	      width: 100%;
	    }
	
	    .data-tables td table {
	      display: block;
	    }
	}
	
</style>
<!-- 다음 우편번호 API -->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
	
</head>
<body id="page-top">
	<div layout:fragment="contents">
		<!-- Begin Page Content -->
		<div class="container-fluid">
			<!-- Page Heading -->
			<div class="d-sm-flex align-items-center justify-content-between mb-4">
				<h1 class="h3 mb-2 text-gray-800">거래처관리</h1>
			</div>
			
			<!-- btnCommand Area -->
			<div class="btnCommand">
				<button type="button" class="btn btn-primary orderBtn" data-bs-toggle="modal" data-bs-target="#exampleModal">
				  거래처 등록
				</button>
				<button type="button" class="btn btn-danger deleteBtn" id="orderDelte">
				  삭제
				</button>
			</div>
			
			<!-- Modal -->
			<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
			  <div class="modal-dialog modal-dialog-scrollable">
			    <div class="modal-content">
			      <div class="modal-header">
			        <h3 class="modal-title fs-5" id="exampleModalLabel">거래처 등록</h3>
			        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
<!-- 			        	<i class="bi bi-x"></i> -->
			        </button>
			      </div>
			      <div class="modal-body">
			      	<form th:action="@{/orders/client}" method="post" th:object="${clientDTO}" id="registerClientForm">
						<table class="data-tables">
							<tr>
								<td>
			                        <table style="width: 100%;">
							            <tr>
							                <th width="130px"><label for="companyNumber">사업자번호</label></th>
							                <td><input type="text" id="companyNumber" th:field="*{companyNumber}"></td>
							            </tr>
							            <tr>
							                <th><label for="companyName">거래처명</label></th>
							                <td><input type="text" id="companyName" th:field="*{companyName}"></td>
							            </tr>
							            <tr>
							                <th><label for="ownerName">대표자명</label></th>
							                <td><input type="text" id="ownerName" th:field="*{ownerName}"></td>
							            </tr>
			                        </table>
								</td>
								<td>
			                        <table style="width: 100%;">
							            <tr>
							                <th width="130px"><label for="companyCategory">업태</label></th>
							                <td><input type="text" id="companyCategory" th:field="*{companyCategory}"></td>
							            </tr>
							            <tr>
							                <th><label for="companySubject">종목</label></th>
							                <td><input type="text" id="companySubject" th:field="*{companySubject}"></td>
							            </tr>
							            <tr>
							                <th><label for="isDeleted">삭제유무</label></th>
							                <td>
							                    <select id="isDeleted" th:field="*{isDeleted}">
							                        <option th:value="N">활성화</option>
							                        <option th:value="Y">비활성화</option>
							                    </select>
							                </td>
							            </tr>
			                        </table>
								</td>
							</tr>
						</table>
						
						<!-- ------------------------------------------------- -->
						<hr>
						<table class="data-tables">
				            <tr>
								<td>
			                        <table style="width: 100%;">
							            <tr>
							                <th width="130px"><label for="phoneNumber">전화</label></th>
							                <td><input type="text" id="phoneNumber" th:field="*{phoneNumber}"></td>
							            </tr>
							            <tr>
							                <th><label for="eMail">이메일</label></th>
							                <td><input type="text" id="eMail" th:field="*{eMail}"></td>
							            </tr>
							            <tr>
							                <th><label for="faxNumber">팩스번호</label></th>
							                <td><input type="text" id="faxNumber" th:field="*{faxNumber}"></td>
							            </tr>
			                        </table>
								</td>
								<td>
			                        <table style="width: 100%;">
							            <tr>
			                                <th style="vertical-align: top; width: 130px;">주소</th>
			                                <td>
			                                    <input type="text" id="postCode" class="postCode" th:field="*{postCode}" maxlength="5">
			                                    <button type="button" id="searchAddressBtn" class="btn btn-outline-primary ml-2">주소찾기</button><br>
			                                    <input type="text" id="address1" class="address1" th:field="*{address1}" placeholder="기본주소 입력"><br>
			                                    <input type="text" id="address2" class="address2" th:field="*{address2}" placeholder="상세주소 입력">
			                                </td>
							            </tr>
			                        </table>
								</td>
							</tr>
						</table>
						
						<!-- ------------------------------------------------- -->
						<hr>
						<table class="data-tables">
				            <tr>
								<td>
			                        <table style="width: 100%;">
							            <tr>
							                <th width="130px"><label for="creditLimit">여신한도</label></th>
							                <td><input type="text" id="creditLimit" th:field="*{creditLimit}"></td>
							            </tr>
							            <tr>
							                <th><label for="memo">메모</label></th>
							                <td><input type="text" id="memo" th:field="*{memo}"></td>
							            </tr>
			                        </table>
								</td>
								<td>
			                        <table style="width: 100%;">
							            <tr>
							                <th width="130px"><label for="status">상태</label></th>
							                <td><input type="text" id="status" th:field="*{status}"></td>
							            </tr>
							            <tr>
							                <th><label for="statusMessage">상태(상세내용)</label></th>
							                <td><input type="text" id="statusMessage" th:field="*{statusMessage}"></td>
							            </tr>
			                        </table>
								</td>
							</tr>
						</table>
						<!-- ----------------------------------------- -->
						<div class="modal-footer">
							<button type="button" id="register_client" class="btn btn-primary">등록</button>
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
						</div>
					</form>
			      </div>
			    </div>
			  </div>
			</div>
			
			<script type="text/javascript">
				
			</script>
			
			<div class="card shadow mb-4">
				<div class="card-body">
					<div class="table-responsive">
						<table class="table table-bordered" id="dataTable" width="100%" cellspacing="0" th:object="${clientDTOList}">
							<thead>
								<tr>
									<th class="checkHead">#</th>
									<th>사업자 번호</th>
									<th>거래처명</th>
									<th>대표이름</th>
									<th>담당자 이름</th>
									<th>업태</th>
									<th>종목</th>
									<th>여신한도</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="item, status : ${clientDTOList}" th:data-id="${item.companyNumber}">
									<td><input type="checkbox"></td>
									<td th:text="${item.companyNumber}"></td>
									<td th:text="${item.companyName}"></td>
									<td th:text="${item.ownerName}"></td>
									<td th:text="${item.regId}"></td>
									<td th:text="${item.companyCategory}"></td>
									<td th:text="${item.companySubject}"></td>
									<td th:text="${item.creditLimit}"></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
		<script type="text/javascript">
			$(function () {
				$('#register_client').off("click").on("click", function() {
					let form_date = $('#registerClientForm').serialize();
					
					$.ajax({
						url: "/orders/client",
						type: "POST",
						data : form_date,
						success: function(response) {
							if(response === "success") {
								alert("등록되었습니다.");
								window.location.reload();
							} else {
								console.log(response);
							}
						},
						error: function(error) {
							console.error(error);
						}
					});
				});
				$("#dataTable tbody").on('click', 'tr', function() {
					var businessNumber = $(this).data('id');
					console.log(businessNumber);
					location.href="/orders/clientDetail?businessNumber=" + businessNumber;
				});
				
				//---------------------------------------------------
				// 주소(다음 우편번호 API 활용)
				// "t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js" 스크립트 파일 로딩 필수!
				$("#searchAddressBtn, .postCode").click(function() {
					new daum.Postcode({
				        oncomplete: function(data) { 
							// 1) 우편번호(zonecode) 가져와서 우편번호 항목(postCode)에 출력              
				            $(".postCode").val(data.zonecode).addClass("filled");
					
							// 2) 기본주소(address) 또는 도로명주소(roadAddress) 가져와서 
							//    기본주소 항목(address1)에 출력
							let address = data.address;
				            
				            // 3) 만약, 건물명(buildingName)이 존재할 경우(= 널스트링이 아님)
				            //    기본 주소 뒤에 건물명 결합
				            if(data.buildingName !== ''){
				               address += "(" + data.buildingName + ")";
				            }
				            
				            // 4) 기본주소(+ 건물명)를 기본주소 항목(address1)에 출력
				            $(".address1").val(address).addClass("filled");
				            
				            // 5) 상세주소 항목(address2)에 포커스 요청
				            $(".address2").focus();
				        }
				    }).open();
				});
			});
		</script>
	</div>
	<th:block layout:fragment="script">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
		<script src="/js/datatables/jquery.dataTables.min.js"></script>
		<script src="/js/datatables/dataTables.bootstrap4.min.js"></script>
		<script src="/js/demo/datatables-demo.js"></script>
	</th:block>
	
	
	
</body>

</html>